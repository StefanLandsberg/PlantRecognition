<!doctype html>
<html lang="en">
<%- include('partials/head', { title: 'BotanicaVision' , styles: ['/css/app.css'] }) %>

  <body>
    <script src="/config.js"></script>

    <div id="app">
      <%- include('partials/nav') %>

        <main class="app-main">
          <div id="map"></div>

          <aside id="drawer" class="drawer">
            <div class="drawer-header">Detections</div>
            <div id="detections-list" class="detections"></div>
          </aside>

          <section id="video-panel" class="video-panel hidden">
            <video id="video" autoplay playsinline muted></video>
            <canvas id="frame" class="hidden"></canvas>
            <button id="btn-stop">Stop</button>
          </section>
        </main>

        <footer id="action-bar" class="action-bar">
          <button id="btn-video">Live Video</button>
          <input id="file-input" type="file" accept="image/*" hidden />
          <button id="btn-upload">Upload Image</button>
        </footer>
    </div>
    <svg style="display:none">
      <defs>
        <filter id="protanopia">
          <feColorMatrix type="matrix" values="0.567 0.433 0 0 0  0.558 0.442 0 0 0  0 0.242 0.758 0 0  0 0 0 1 0" />
        </filter>
        <filter id="deuteranopia">
          <feColorMatrix type="matrix" values="0.625 0.375 0 0 0  0.7 0.3 0 0 0  0 0.3 0.7 0 0  0 0 0 1 0" />
        </filter>
        <filter id="tritanopia">
          <feColorMatrix type="matrix" values="0.95 0.05 0 0 0  0 0.433 0.567 0 0  0 0.475 0.525 0 0  0 0 0 1 0" />
        </filter>
      </defs>
    </svg>
    <script type="module" src="/js/main.js"></script>
    <script async id="maps-loader"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const body = document.body;
        const savedDarkMode = localStorage.getItem('darkMode');
        const savedColorBlindMode = localStorage.getItem('colorBlindMode');

        if (savedDarkMode === 'true') {
          body.classList.remove('light-mode');
          body.classList.add('dark-mode');
        } else {
          body.classList.remove('dark-mode');
          body.classList.add('light-mode');
        }

        body.classList.remove('protanopia', 'deuteranopia', 'tritanopia');
        if (savedColorBlindMode && savedColorBlindMode !== 'none') {
          body.classList.add(savedColorBlindMode);
        }
      });
    </script>
  </body>

</html>